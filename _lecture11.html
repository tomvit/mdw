<!DOCTYPE html>
<!--
    Middleware and Web Services, CTU course slides
    (cc) 2010-2012 Tomas Vitvar, http://vitvar.com
    written for Humla, an open source HTML5 presentation environment
-->
<html>  
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
        <meta name="course"   content="Middleware and Web Services"/>
        <meta name="lecture"  content="Lecture 10"/>
        <meta name="keywords" content="Business Process Management"/>
           
        <link type="text/css" rel="stylesheet" href="css/meta.css"></link>   
        <link type="text/css" rel="stylesheet" href="css/ctu-fit.css"></link>   
        <link type="text/css" rel="stylesheet" href="humla/lib/core/humla.css"></link>   

        <script type="text/javascript" src="humla/lib/humla.js"></script>
        <title>Service Orchestration</title>
    </head>
    
    <body>
        <footer>
            <p><b>#META_LECTURE#: #TITLE#</b>,&nbsp;<span class="meta_semester"/>,&nbsp;
            <span class="meta_twitter"/></p>
            <p><b>&#8210; #SLIDE_NO# &#8210;</b></p>
        </footer>

        <div class="slide intro">
            <hgroup>
                <h1><span class="meta_course"/></h1>
                <h2>#META_LECTURE#: #TITLE#</h2>
            </hgroup>
            <div class="author">
                <p class="meta_author"/>
                <p><span class="meta_email"/> &bull; <span class="meta_twitter"/> &bull; 
                <span class="meta_web"/></p>
            </div>
            <center><div class="meta_logo"></div></center>
            <div class="org">
                <p class="meta_org"/>
                <p><span class="meta_orgfac"/> &bull; <span class="meta_field"/> 
                &bull; <span class="meta_orgweb"/></p>
            </div>
            <div class="etc">
                <div class="text-info">
                    Modified: #LAST_MODIFIED#<br/>
                    Humla v#HUMLA_VERSION#
                </div>
                <a href="http://creativecommons.org/licenses/by-sa/3.0/"><div class="license"></div></a>
                <div class="oppa"></div>
            </div>
        </div>
        
        <div class="slide outline"></div>        
        
        <section>
        	<header>Business Processes in SOA</header>
        	
        	<div class="slide">
				<hgroup>
					<h1>Overview</h1>
				</hgroup>
				<ul class="xx-small">
					<li>Service Orchestration</li>
					<ul>
						<li>How a functionality of a service is realized by interactions with other services.</li>
						<li>Business process is one possible form of a service orchestration that uses a business process language 
							to describe the orchestration.</li>
					</ul>
					<li>Business Process</li>
					<ul>
						<li>A set of activities and transitions between activities performed by one or more persons or systems..</li>
						<li>A process usually spans multiple departments/divisions and applications</li>
					</ul>
					<li>Business Process Management</li>
					<ul>
						<li>Management of business processes that involves:</li>
						<ul>
							<li>Methodology to design processes</li>
							<li>Tools to design, execute, monitor processes</li>
						</ul>
					</ul>					
					<li>Business process standardization</li>
					<ul>
						<li>APQC &ndash; American Productivity & Quality Center</li>
						<li>TMForum &ndash; eTOM &ndash; Enhanced Telekom Operations Map (Business Process Framework)</li>
					</ul>
				</ul>
        	</div>

  	    	<div class="slide">
				<hgroup>
					<h1>Process Classification Framework: Recall</h1>
				</hgroup>
				<div class="h-drawing" id="1ou4lOAvwaFP2MJo1RQbJOTF-DavfYjcUF6MELE6cWws"></div>
			</div>
      	
      		<div class="slide">
				<hgroup>
					<h1>Level 5 Business Process</h1>
				</hgroup>
				<ul class="x-small">
					<li>Level 5 Details</li>
					<ul>
						<li>The lowest level of a process classification framework</li>
						<li>Level 5 business process involves technical parts that run in ESB</li>
					</ul>
				</ul>
				<div class="h-drawing" style="height: 340px; margin-top: 40px" 
					id="1-MNreOnY0NDd_NUK_WlZXv7fIY7oMk1J39TZLxP5l4Q" format="png"></div>
      		</div>
      		
      		<div class="slide">
				<hgroup>
					<h1>Languages</h1>
				</hgroup>
				<ul class="small">
					<li>Business Process Management Notation (BPMN)</li>
					<ul>
						<li>Easy to understand</li>
						<li>Originally only a language for people to model processes</li>
						<li>Now also possible to describe execution ready processes</li>
						<ul>
							<li>Seamless transition from a business view to a technical view</li>
						</ul>
					</ul>
					<li>Business Process Execution Language (BPEL)</li>
					<ul>
						<li>Only execution language for ESB, not suitable for modeling higher levels of business processes</li>
						<li>Architets need to translate from BPMN (or another language) to BPEL</li>
						<ul>
							<li>Part of technical SOA design</li>
						</ul>
					</ul>
				</ul>
      		</div>

			<div class="slide outline"></div>
			
			<section>
				<header>Process Execution Models</header>
				
	      		<div class="slide">
					<hgroup>
						<h1>Static Process Exeuction</h1>
					</hgroup>
					<ul class="small">
						<li>Explicitly defined process using control flows</li>
					</ul>
					<div class="h-drawing" id="1r83N3bTF61ovBoT1jLT8f3L0UzpA6kQqhlar-UKyzt4"></div>
	      		</div>

	      		<div class="slide">
					<hgroup>
						<h1>Dynamic Process Execution</h1>
					</hgroup>
					<ul class="small">
						<li>Implicitly defined process using rules</li>
					</ul>
					<div class="h-drawing" id="1bfOg9ddws9GHYsLdErX62PnAyh6pl-D3Ocuab5L18f8"></div>
					<ul class="xx-small">
						<li>Forward-chaining algorithm (inference)</li>
						<ol>
							<li>A user defines a goal &ndash; described as a state (memory content)</li>
							<li>Rule engine finds a rule which condition matches the memory'c content</li>
							<li>Rule's action is executed; the result may add or modify data in the memory</li>
							<li>When the memory content matches the goal, execution stops otherwise go to 2</li>
						</ol>
					</ul>
	      		</div>

	      		<div class="slide">
					<hgroup>
						<h1>Dynamic Process Execution Example</h1>
					</hgroup>
					<ul class="xx-small">
						<li>Rule Set</li>
						<ul>
							<li>A: if a customer is a premium customer, give them 10% discount<br/>
							<code>if customer.type=='premium' then order.discount=0.1</code></li>
							<li>B: if a customer is a gold customer, give them 5% discount<br/>
							<code>if customer.type=='gold' then order.discount=0.05</code></li>
							<li>C: if a customer spends is 1,000 or more, make them a premium customer<br/>
							<code>if customer.revenue>1000 then customer.type='premium'</code></li>	
							<li>Note: actions are memory modifications but can be results of service calls</li>						
						</ul>
						<li>Execution</li>
						<ul>
							<li>Option 1</li>
							<ul class="no-bullet">
								<li>MEM: <code>customer.type=='gold'</code>, <code>customer.revenue==1500</code><br/>
									Rules: <code>C, A</code><br/>
									MEM: <code>customer.type=='premium'</code>, <code>customer.revenue==1500</code>, 
									<code>order.discount==0.1</code>
								</li>
							</ul>
							<li>Option 2</li>
							<ul class="no-bullet">
								<li>MEM: <code>customer.type=='gold'</code>, <code>customer.revenue==200</code><br/>
									Rules: <code>B</code><br/>
									MEM: <code>customer.type=='gold'</code>, <code>customer.revenue==200</code>, 
									<code>order.discount==0.05</code>
								</li>
							</ul>
						</ul>
					</ul>
	      		</div>
      		
      		</section>

      		<div class="slide outline"></div>	

      		<section>
				<header>Key Mapping</header>
        	
	        	<div class="slide">
					<hgroup>
						<h1>Overview</h1>
					</hgroup>
					<ul class="x-small">
						<li>What is key mapping</li>
						<ul>
							<li>Key = identifier of en entity in a back-end application</li>
							<li>Key Mapping = a mapping of an ID of an entity in one system to an ID of the same entity in another system.</li>
							<li>Key mapping is realized using universal IDs (UID)</li>
						</ul>      			
						<li>Example</li>
						<ul>
							<li>A customer MOON exists in CRM and OMS systems</li>
							<li>In CRM system, MOON has an <code>CRM-ID=AB1</code></li>
							<li>In OMS system, MOON has an <code>CRM-ID=45A</code></li>
							<li>Key mappig allows to map the <code>CRM-ID AB1</code> to the <code>OMS-ID 45A</code></li>
							<li>Key mapping is a table</li>
							<ul class="no-bullet">
								<li><code>CRM-ID &rarr; UID &rarr; OMS-ID</code></li>
							</ul>
						</ul>
					</ul>
				</div>

				<div class="slide">
					<hgroup>
						<h1>Key Mapping Example</h1>
					</hgroup>
					<div id="1G4XbrYDV4ptT6GvXzWHio5bp2tfRpZd8MwrOpCcIR0U" class="h-drawing" style="height: 410px; margin-top: 60px"></div>
		    	</div>        	

      		</section>

      		        	
        </section>
        
        <div class="slide outline"></div>        
        
        <section>
        	<header>Business Process Management Notation</header>
        	
        	<div class="slide">
				<hgroup>
					<h1>BPMN Constructs &ndash; Activities and Gateways</h1>
				</hgroup>
				<ul class="xx-small">
					<li>Activities (Tasks)</li>
					<div class="h-drawing" style="height: 100px; margin: -7px 0px 0px -50px" 
						id="1RkfCK67eEbj7C9ePrs7wrw3XGrR_xosvK_AMk2Qm88Q" format="png"></div>
					<ul>
						<li>Service Task &ndash; synchronous service invocation</li>
						<li>Send and receive task &ndash; asynchronous service invocation</li>
						<li>User task &ndash; human step, managed by workflow engine</li>
						<li>Manual task &ndash; human step, not managed by workflow engine</li>
						<li>Script task &ndash; automatic activity, assigning variables, modify variables' values</li>
						<li>Call activity &ndash; to call a another process (modularisation, process chaining)</li>
					</ul>
					<li>Gateways</li>
					<div class="h-drawing" style="height: 100px; margin: -7px 0px -30px -40px" 
						id="187HC23lxGl8dfRQA9pX2ZTKpgjfJiqgoO6CICIPKm64" format="png"></div>
					<ul>
						<li>Exclusive OR (XOR)</li>
						<li>Inclusive OR (OR)</li>
						<li>Parallel fork and join (AND)</li>
						<li>Complex gateway</li>
					</ul>
				</ul>
			</div>

        	<div class="slide">
				<hgroup>
					<h1>BPMN Constructs &ndash; Catch Events</h1>
				</hgroup>
				<ul class="xx-small">
					<li>Catch Events</li>
					<ul>
						<li>They start a process or continue a process from a sub-process when event occurs.</li>
						<div id="1kNXpNqUIATLok6rH0ngEIZUpvQ5oeFU7_DkEdSQ-fK4"
							style="height: 100px; margin: 0px 0px 0px -100px" 
							class="h-drawing" format="png"></div>
						<li>Catch Event Types</li>
						<ul>
							<li>Start Message &ndash; starts a process by a new message</li>
							<li>Start Timer &ndash; starts a proceess by a timer</li>
							<li>Start Signal &ndash; starts a process by a new event</li>
							<li>Catch Error &ndash; catches error during execution of an activity (boundary event)</li>
							<li>Catch Timer &ndash; a timeout when during execution of an activity (boundary event)</li>
							<li>Catch Signal &ndash; catches a signal during execution of an activity (boundary event)</li>
						</ul>
					</ul>
				</ul>
			</div>

        	<div class="slide">
				<hgroup>
					<h1>BPMN Constructs &ndash; Throw Events</h1>
				</hgroup>
				<ul class="xx-small">
					<li>Throw Events</li>
					<ul>
						<li>They end a process or a sub-process</li>
						<div id="1bKjB33--JNbhapfgGnUs2W9QSzH0WPFrFlqHzXKyIpI" 
							style="height: 100px; margin: 0px 0px 0px -140px" format="png"						
							class="h-drawing"></div>
						<li>Throw Event Types</li>
						<ul>
							<li>End Message &ndash; ends a process by sending a message back to client</li>
							<li>End Terminate &ndash; ends a process silently</li>
							<li>End Signal &ndash; ends a process by signalling an event</li>
							<li>End Error &ndash; ends a process by throwing an error (fault)</li>
							<li>Throw Message &ndash; throws a message during process execution</li>
							<li>Throw Signal &ndash; throws an EDN event during process execution</li>
						</ul>
					</ul>
				</ul>
			</div>
			
			<div class="slide">
				<hgroup>
					<h1>Swim Lanes</h1>
				</hgroup>
				<ul class="xx-small">
					<li>Swim Lanes</li>
					<ul>
						<li>Group of activities in a process</li>
						<li>Each swim lane is associated with a role; a user in the role performs activities</li>
						<li>A special role "Automated" or "System" defines automated activities or activites performed by the 
						system, not humans.</li>
					</ul>
					<li>Example</li>
					<div class="h-drawing" id="1l7AcdnWGOrCMeZ3b5n34AyjtKgcTobRCEL5kHrgCgD0" 
						format="png" style="height: 310px"></div>
				</ul>				
			</div>

        	<div class="slide outline"></div>        			
			
			<section>
				<header>Patterns</header>

        		<div class="slide">
					<hgroup>
						<h1>Exclusive OR</h1>
					</hgroup>
					<ul class="x-small">
						<li>Definition</li>
						<ul>
							<li>XOR defines multiple alternative paths</li>
							<li>One and only one path can result from an evaluation of conditions on each branch</li>
							<li>There must be a <b>default path</b></li>
							<ul>
								<li>Path that will be used when no conditions on other paths will evaluate to true</li>
							</ul>
						</ul>
						<li>Example</li>
					</ul>
					<div id="1FWUsUDHNEe_HjJx52j2tGUg-_LYHoROD-V6YM-Fv2Uk" class="h-drawing" 
						format="png" style="height: 250px; margin-top: -20px"></div>
				</div>
								
				<div class="slide">
					<hgroup>
						<h1>Parallel Fork and Join</h1>
					</hgroup>
					<ul class="x-small">
						<li>Definition</li>
						<ul>
							<li>AND Gateway &ndash; defines multiple paths</li>
							<li>All paths are processed</li>
							<li>All paths must be either joined by AND Gateway or each path may end with a separated end events</li>
						</ul>
						<li>Example</li>
					</ul>
					<div id="190Jyq40Srw_dxAZmMjpXakU2yf6n4h7B3Qer2taTzfQ" class="h-drawing" 
						format="png" style="height: 250px"></div>					
				</div>

				<div class="slide">
					<hgroup>
						<h1>Inclusive OR</h1>
					</hgroup>
					<ul class="x-small">
						<li>Definition</li>
						<ul>
							<li>OR Gateway &ndash; defines multiple paths</li>
							<li>One or more paths are processed in parallel</li>
							<ul>
								<li>There can be more than one possible outcomes</li>
							</ul>
							<li>There can be a default path</li>
							<li>All paths must be either joined by OR Gateway or each path may end with a separated end events</li>
						</ul>
						<li>Example</li>
					</ul>
					<div id="1ADJOdNWTf_PMXT0ux1CGHl5PNKt1oly_loAaBaufyIw" class="h-drawing" 
						format="png" style="height: 250px; margin-top: -10px"></div>					
					
				</div>
				
				<div class="slide">
					<hgroup>
						<h1>Complex Gateway</h1>
					</hgroup>
					<ul class="x-small">
						<li>Definition</li>
						<ul>
							<li>Evaluates conditions to decide when the process should continue</li>
							<li>Used only when merging process flows (OR is used for splitting)</li>
						</ul>
						<li>Example</li>
						<div class="h-drawing" id="1JXSk2g734D70dIje3zVBGu6xChpm0o28ujx2ls7TTAc"
							style="height: 200px" format="png"></div>
						<ul>
							<li>Complex gatway condition</li>
							<pre class="brush: plain">
								credit-card/balance/text() > 1000 OR customer/history/num-purchases/text() > 10</pre>
							<ul>
								<li>Only one condition needs to be satisfied for the process to continue</li>
								<li>Other parallel flows are canceled</li>
							</ul>
						</ul>
					</ul>
				</div>
				
				<div class="slide">
					<hgroup>
						<h1>Loops</h1>
					</hgroup>
					<ul class="x-small">
						<li>Definition</li>
						<ul>
							<li>Loops can be created with XOR Gateways by connecting a flow to a previous step</li>
							<li>XOR checks for conditions</li>
							<ul>
								<li>logical expression or counters</li>
							</ul>
						</ul>
						<li>Example</li>
						<div class="h-drawing" format="png" id="1EcY1Lw5BYDtWFSf11hj5vjx7vb8YkdnZaR0yPwG5xSk"
							style="height: 150px"></div>
						<ul>
							<li>Example condition on "YES" path</li>
							<pre class="brush: plain">
							quote/price/text() > 0</pre>
						</ul>
					</ul>
				</div>
				
				<div class="slide">
					<hgroup>
						<h1>Error Handling</h1>
					</hgroup>
					<ul class="small">
						<li>Definition</li>
						<ul>
							<li>Mechanism to handle errors during process executions</li>
							<li>Throwing errors</li>
							<ul>
								<li>On evaluation of conditions</li>
								<li>A result of external service calls</li>
							</ul>
							<li>Catching Errors</li>
							<ul>
								<li>Take actions to resolve errors, continue process execution</li>
								<li>Throw errors  as a result of process execution</li>
							</ul>
						</ul>
						<li>Implementation</li>
						<ul>
							<li>Use boundary catch error events to catch errors on activities or sub-processes</li>
							<li>Implement paths in process flows that resolve errors</li>
						</ul>
					</ul>
				</div>
						
				
				
			</section>
						
        	<div class="slide outline"></div>        			
			
			<section>
				<header>Conversation and Correlation</header>

        		<div class="slide">
					<hgroup>
						<h1>Conversation: Recall</h1>
					</hgroup>
					<ul class="x-small">
						<li>Definition</li>
						<ul>
							<li>A group of client-service interactions that logically and technically belong 
								together, e.g. <code>submitOrder</code>, <code>getOrderStatus</code>, <code>cancelOrder</code></li>
							<li>There is typically one conversation per process but can be more</li>
						</ul>
						<li>Implementation</li>
						<ul>
							<li>Single conversation corresponds to a single WSDL interface definition (<code>portType</code> in WSDL 1.1)</li>
							<li>Two conversations will have own interface definition each</li>
							<ul>
								<li>hence you can define separated binding for each</li>
							</ul>
							<li>To relate interactions in a single conversation, you should have:</li>
							<ul>
								<li>a <b>main process</b>, that is a main operation/event that triggers the process and creates a conversation, 
									e.g. <code>submitOrder</code></li>
								<li>a <b>sub-process</b> to the main process, e.g. <code>checkStatus</code></li>
							</ul>
							<li>WS-Addressing defines <code>MessageID</code> element that is a conversation ID</code></li>
							<li>See details in <a href="lecture8.html#/30">lecture 8</a>
						</ul>
					</ul>
				</div>

				<div class="slide">
					<hgroup>
						<h1>Correlation</h1>
					</hgroup>
					<ul class="x-small">
						<li>Definition</li>
						<ul>
							<li>Correlation associates a client interaction with a running process instance by using 
								correlation keys and data in an nput message.</li>
							<li>A process may have one or more correlations defined</li>
						</ul>
						<li>Correlation keys and properties</li>
						<ul>
							<li>Correlations are defined by so called <b>correlation keys</b></li>
							<li>A key may have one or more properties</li>
							<ul>
								<li>Each property value is defined by an xpath on a message structure</li>
							</ul>
						</ul>
						<li>Example</li>
						<ul>
							<li>A correlation with two properties</li>
							<ul>
								<li>Key: <code>order_correlation</code></li>
								<li>Property 1: <code>customer_id</code></li>
								<li>Property 2: <code>order_id</code></li>							
							</ul>	
						</ul>
					</ul>
				</div>

				<div class="slide">
					<hgroup>
						<h1>Correlation Example</h1>
					</hgroup>
					<ul class="xx-small">
						<li>Correlation key for Order message</li>
						<ul>
							<li>Order message</li>
						<pre class="brush: xml; highlight: [3,5,6,7]">
						&lt;s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">
						    &lt;s:Body>
						    	&lt;ns1:submitOrder xmlns:ns1="http://xmlns.oracle.com/bpmn/bpmnProcess/Process" 
						    					 xmlns:ns2="http://www.example.org/order">
						        	&lt;ns2:Order>
						            	&lt;ns2:OrderId>566&lt;/ns2:OrderId>
						            	&lt;ns2:CustomerId>4354&lt;/ns2:CustomerId>
						                &lt;ns2:Address>Thakourova 6&lt;/ns2:Address>
						                &lt;ns2:Phone>+42024537765&lt;/ns2:Phone>
						                &lt;ns2:LineItems>
						                	&lt;ns2:item>
						                    	&lt;ns2:name>HP ProBook 4540s&lt;/ns2:name>
						                        &lt;ns2:price>900&lt;/ns2:price>
						                    &lt;/ns2:item>
						                &lt;/ns2:LineItems>
						            &lt;/ns2:Order>
						        &lt;/ns1:submitOrder>
						    &lt;/s:Body>
						&lt;/s:Envelope></pre>
						<li>Correlation key <code>order_correlation</code>, xpath definition</li>						
						<pre class="brush: plain">
							customer_id property: /ns1:submitOrder/ns2:Order/ns2:CustomerId						
							order_id property:    /ns1:submitOrder/ns2:Order/ns2:OrderId</pre>						
					</ul>
				</div>
				
			</section>
		</section>
        
    </body>