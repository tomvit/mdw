<!DOCTYPE html>
<!--
    Middleware and Web Services, CTU course slides
    (cc) 2010-2012 Tomas Vitvar, http://vitvar.com
    written for Humla, an open source HTML5 presentation environment
-->
<html>  
    <head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
        <meta name="course"   content="Middleware and Web Services"/>
		<meta name="lecture"  content="Lecture 4"/>
   		<meta name="keywords" content="Web Server, Application Server, JEE"/>
           
        <link type="text/css" rel="stylesheet" href="css/meta.css"></link>   
        <link type="text/css" rel="stylesheet" href="css/ctu-fit.css"></link>   
        <link type="text/css" rel="stylesheet" href="humla/lib/core/humla.css"></link>   

        <script type="text/javascript" src="humla/lib/humla.js"></script>
        <title>Application Server</title>
	</head>
	
	<body>
		<footer>
			<p><b>#META_LECTURE#: #TITLE#</b>,&nbsp;<span class="meta_semester"/>,&nbsp;
			<span class="meta_twitter"/></p>
			<p><b>&#8210; #SLIDE_NO# &#8210;</b></p>
		</footer>

    	<div class="slide intro">
			<hgroup>
				<h1><span class="meta_course"/></h1>
 				<h2>#META_LECTURE#: #TITLE#</h2>
			</hgroup>
			<div class="author">
				<p class="meta_author"/>
				<p><span class="meta_email"/> &bull; <span class="meta_twitter"/> &bull; 
				<span class="meta_web"/></p>
			</div>
			<center><div class="meta_logo"></div></center>
			<div class="org">
				<p class="meta_org"/>
				<p><span class="meta_orgfac"/> &bull; <span class="meta_field"/> 
				&bull; <span class="meta_orgweb"/></p>
			</div>
			<div class="etc">
        		<div class="text-info">
    				Modified: #LAST_MODIFIED#<br/>
					Humla v#HUMLA_VERSION#
				</div>
				<a href="http://creativecommons.org/licenses/by-sa/3.0/"><div class="license"></div></a>
				<div class="oppa"></div>
			</div>
		</div>
		
        <div class="slide outline"></div>
        
        <section>
            <header>Architecture</header>
            
	        <div class="slide">
	            <hgroup>
	                <h1>Application Server Overview</h1>
	            </hgroup>  
	            <ul class="x-small">
	                <li>An environment that runs an application logic</li>
	                <ul>
	                    <li>A client communicates with the server using an application protocol</li>
	                </ul>
	                <li>Application Server</li>
                 	<ul>
                        <li>A modular environment</li>
						<ul>
							<li>provides technology to realize enterprise systems</li>
							<li>JEE containers &ndash; Java technology for AS components</li>
							<li>Supports a variety of objects such as Servlets, JPSs, JMS</li>
						</ul>
						<li>Provides services such as naming and directory, performance, failover</li>
                        <li>Provides Web server capabilities</li>
						<li>Can be a single server or multiple servers</li>
					</ul>
	                <li>Web Tier &ndash; HTTP Server</li>
					<ul>
						<li>Web Server supports HTTP only</li>
						<li>HTTP request/response, security, proxy, caching</li>
					</ul>
	                <li>Communication models</li>
	                <ul>
	                    <li>Blocking I/O (also called synchronous I/O)</li>
	                    <li>Non-blocking I/O (also called asynchronous I/O)</li>
	                </ul>
	            </ul>                
	        </div>

            <div class="slide">
    			<hgroup>
    				<h1>Java Enterprise Edition &ndash; JEE</h1>
    			</hgroup>
                <ul class="small">
                    <li>Java Enterprise Edition (JEE)</li>
                    <ul>
                        <li>Collection of technologies for server-side programming</li>
						<li>Programming of application components</li>
                        <li>Main technologies</li>
                        <ul>                        
                            <li>Servlet technology and Java Server Pages (JSP)</li>
                            <li>Remote Method Invocation (RMI)</li>
                            <li>Java Database Connectivity Services (JDBC)</li>
                            <li>Java Messaging System (JMS)</li>
                        </ul>
                    </ul>
                    <li>Basis for many application servers such as</li>
                    <ul class="x-small">
                        <li>Oracle WebLogic</li>
                        <li>Google AppEngine (Java)</li>
                        <li>JBoss</li>
                        <li>GlassFish</li>
                        <li>IBM WebSphere</li>
                    </ul>
                </ul>
            </div>

            <div class="slide">
        		<hgroup>
    				<h1>Application Server Layers</h1>
    			</hgroup>
				<div class="h-drawing" id="17DlmmSs0FHtUNWKTk1y1a0fWotKTB2m91nKjqYVyZiE" style="height: 250px"></div>
				<ul class="x-small">
					<li>Features</li>
					<ul>
						<li>AS appears as a single process in the OS</li>
						<ul>
							<li>you can use standard OS commands to investigate its operation</li>
							<li>AS listens on a single or multipe IPs (VIPs) and a tcp port</li>
						</ul>
						<li>AS is a Java process</li>
						<ul>
							<li>you can use Java tools to investigate its operation</li>
							<li>Garbage collector stats, thread dumps, memory allocations, etc.</li>
						</ul>
					</ul>
				</ul>
			</div>	

            <div class="slide">
        		<hgroup>
    				<h1>Architecture &ndash; Terminology</h1>
    			</hgroup>
				<ul class="x-small">
					<li>Domain</li>
					<ul>
						<li>A group of servers with specific configuration of applications and objects</li>
					</ul>
					<li>Administration Server</li>
					<ul>
						<li>An instance of application server that manages the domain</li>
					</ul>
					<li>Managed Server</li>
					<ul>
						<li>Application server running an instance of an application and objects</li>
					</ul>
					<li>Cluster</li>
					<ul>
						<li>A group of application servers; they contain the same copy of applications and objects</li>
					</ul>
					<li>Machine</li>	
					<ul>
						<li>A physical machine and OS running one or more servers (Admin or Managed)</li>
					</ul>
					<li>Load Balancer</li>
					<ul>
						<li>A network element that distributes client requests to managed servers based on a specific algorithm</li>
					</ul>
				</ul>
			</div>	

            <div class="slide">
        		<hgroup>
    				<h1>Architecture &ndash; Weblogic Server</h1>
    			</hgroup>
				<div class="h-drawing" id="18vW_i7-8GeUHUdE9q9dccbAvDbA5b1fuQ-qAovzabTc" style="height: 450px"></div>
			</div>	

            <div class="slide">
        		<hgroup>
    				<h1>Console Example &ndash; Weblogic Server</h1>
    			</hgroup>
				<div class="h-drawing" id="18_IxASaDBUOGplwP64NihWC4669RkSEmnM5Y0HdQyZI" format="png" style="height: 450px" ></div>
			</div>	

        	<div class="slide outline"></div>

			<section>
				<header>I/O Communication Models</header>

		        <div class="slide"> 
					<hgroup> 
						<h1>Blocking I/O Model</h1> 
					</hgroup> 
					<ul class="small">
						<li>The server creates a thread for every connection</li>
		                   <ul>                    
		                       <li>For example, 1K connections = 1K threads, big overhead</li>
		                   </ul>
		               </ul>
		   			<div id="1QP7gZSS1WS3YquzLekSgdZfcmi4BYArm-K9tuWrULQs" class="h-drawing" style="height: 220px"></div>
		               <ul class="small">
		                   <li>Characteristics</li>
		                   <ul>
		   					<li>the thread is reserved for the connection</li>
						<li>When processing of the request requires other interactions with DB/FS or network 
							communication is slow</li>
		                   <ul>
		                       <li>scales very bad as the thread's execution is "blocked"</li>
		                   </ul>
					</ul>
				</div>

		        <div class="slide"> 
		   			<hgroup> 
						<h1>Non-Blocking I/O Model</h1> 
					</hgroup> 
					<ul class="small">
						<li>Connections maintained by the OS, not the Web app</li>
		                   <ul>                    
		                       <li>The Web app registers events, OS triggers events when occur</li>
		                   </ul>
		               </ul>
		   			<div id="1kxkFc3Chl4qFXxH_4f2seuNbpBdENMyZWMRUmxd1p28" class="h-drawing" style="height: 220px"></div>
		               <ul class="small">
						<li>Characteristics</li>
		                   <ul>
		                       <li>Event examples: new connection, read, write, closed</li>
						    <li>The app may create working threads, but controls the number!</li>
		                       <ul>
						        <li>much less number of working threads as opposed to blocking I/O</li>
		                       </ul>
		                   </ul>
					</ul>
				</div>
			</section>

		</section>

        <div class="slide outline"></div>

		<section>

			<header>Servlet Technology</header>

	        <div class="slide"> 
				<hgroup> 
					<h1>Overview</h1> 
				</hgroup> 
				<ul class="small">
					<li>Technology to extend application server functionalities</li>
					<ul>
						<li>A Java class that can respond to any type of requests</li>
						<ul>
							<li>A servlet defines an interface for a specific protocol</li>
							<li>Your application implements the servlet's interface</li>
						</ul>
					</ul>
					<li>Commonly used to respond to HTTP requests</li>
					<ul>
						<li>A basis for an application running on an application server</li>
						<li>HTTP Servlet Java classes</li>
						<ul>
							<li><code>HttpServlet</code> &ndash; provides HTTP protocol interface</li>
							<li><code>HttpServletRequest</code> &ndash; represents HTTP request</li>
							<li><code>HttpServletResponse</code> &ndash; represents HTTP response</li>
						</ul>
					</ul>
				</ul>
			</div>

            <div class="slide">
        		<hgroup>
    				<h1>Directory Structure</h1>
    			</hgroup>
                <ul class="x-small">
                    <li>Your application</li>
                    <ul>
                        <li>collection of documents and libraries your application requires</li>
                        <li>packaged in <code>war</code> or <code>ear</code> archive</li>
                        <ul>
                            <li>JAR that includes not only java classes but also additional resources such as 
                            <code>.xml</code>, <code>.html</code>, <code>.js</code>, <code>.css</code>, <code>.jpg</code> files.</li>
                        </ul>
                    </ul>
                    <li>Content of <code>war</code> package</li>
                    <pre class="brush: bash; gutter: false; class-name: ''">
                        # web archive root
                        war
                         |   # directories and documents accessible through the app root /
                         |   # such as img, css, js, ...
                         |-- (public-directory | public-document)*
                         |   # directories and documents internal to your application
                         |-- WEB-INF
                                |-- (private-directory | private-document)*
                                |   # compiled java classes of your application
                                |-- classes
                                |   # all java libraries your application requires
                                |-- lib
                                |   # configuration of your application
                                |-- web.xml
                                |-- # other platform-specific configurations 
                                    # such as app-engineweb.xml for GAE
                    </pre>
                </ul>
            </div>

            <div class="slide">
                <hgroup>
    				<h1>Configuration in web.xml</h1>
    			</hgroup>
                <ul class="x-small">
                    <li><code>web.xml</code> defines configuration for</li>
                    <ul>
                        <li>list of servlets, mapping of servlets to URL paths, welcome files, filters, EJB references, 
                        authentication mechanism, etc.</li>
                        <li>basic configuration example:</li>
                    </ul>
                    <pre class="brush: xml">
                        &lt;?xml version="1.0" encoding="utf-8"?>
                        &lt;web-app 
                            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                            xmlns="http://java.sun.com/xml/ns/javaee">
                    
                            &lt;servlet>
                        		&lt;servlet-name>main&lt;/servlet-name>
                        		&lt;servlet-class>com.vitvar.mdw.main&lt;/servlet-class>
                        	&lt;/servlet>
                    
                        	&lt;servlet-mapping>
                        		&lt;servlet-name>main&lt;/servlet-name>
                        		&lt;url-pattern>/&lt;/url-pattern>
                        	&lt;/servlet-mapping>
                    
                        	&lt;welcome-file-list>
                        		&lt;welcome-file>index.jsp&lt;/welcome-file>
                        	&lt;/welcome-file-list>
                        &lt;/web-app>
                    </pre>
                </ul>
            </div>

            <div class="slide">
            	<hgroup>
    				<h1>Handling HTTP Requests</h1>
    			</hgroup>
                <ul class="x-small">
                    <li>HTTP Servlets</li>
                    <ul>
                        <li>Servlet is a class that extends capabilities of application servers 
                        via a request-response programming model</li>
                        <li>HTTP servlets are classes that extend <code>HTTPServlet</code> abstract class</li> 
                        <li>Example:</li>
                    </ul>
                    <pre class="brush: java">
                        package com.vitvar.mdw;
                    
                        import javax.servlet.http.HttpServlet;
                        import javax.servlet.http.HttpServletRequest;
                        import javax.servlet.http.HttpServletResponse;
                    
                        public class Main extends HttpServlet {
                            public doGet(HttpServletRequest request, HttpServletResponse response) {
                                // GET method implementation here
                            }

                            public doPut(HttpServletRequest request, HttpServletResponse response) {
                                // PUT method implementation here
                            }
                        
                            // other methods such as doPost, doDelete, doOptions
                        }
                    </pre>
                </ul>
            </div>

            <div class="slide">
                <hgroup>
    				<h1>Support for Sessions</h1>
    			</hgroup>
                <ul class="x-small">
                    <li><code>HttpSession</code> interface</li>
                    <ul>
                        <li>Allows to store session data in the memory</li>
                        <li>Java API for <a href="#/state-management">HTTP State Management</a></li>
                        <ul>
                            <li>Hides details from developers</li>
                        </ul>
                    </ul>
                    <pre class="brush: java;">
                        // method doGet in a servlet
                        public doGet(HttpServletRequest request, HttpServletResponse response) {
                            // access the session object through the request
                            HttpSession session = request.getSession();
                        
                            // unique identification of the session, the value used for the cookie
                            String id = session.getId();
                        
                            // get the value of the attribute
                            Object value = session.getAttribute("data");

                            // set the value of the attribute
                            session.setAttribute("data", new String("some data"));
                                                    
                            // this will set a max-age of the session cookie 
                            session.setMaxInactiveInterval(3600);
                        }
                    </pre>
                </ul>
            </div>

        </section>		

    	<div class="slide outline"></div>			
					
        <section>
            <header>Remote Method Invocation</header>
            
    		<div class="slide">
				<hgroup>
					<h1>Overview</h1>
				</hgroup>
				<ul class="small">
					<li>Communication among Java-based applications</li>
					<ul>
						<li>Methods of one Java class can be invoked by other Java class remotely.</li>
						<li>Uses Java Remote Method Protocol (JRMP)</li>
						<ul>
							<li>Java-specific application protocol over TCP/IP</li>
						</ul>
						<li>Basis for JEE technologies, such as JMS</li>
					</ul>
					<li>Terminology</li>
					<ul class="x-small">
						<li><b>Client</b> &ndash; a program that invokes a remote method</li>
						<li><b>Server</b> &ndash; a program that exports a remote object</li>
						<li><b>Stub</b> &ndash; a representation of the client-side object for communication</li>
						<li><b>Skeleton</b> &ndash; a representation of the server-side object for communication</li>
						<li><b>Registry</b> &ndash; a component that holds a stub</li>
						<li><b>Marshalling/Unmarshalling</b> &ndash; a process of transforming memory representation 
						of the object to a form suitable for network transmittion and vice-cersa</li>
					</ul>
				</ul>
			</div>
			
    		<div class="slide">
				<hgroup>
					<h1>Architecture</h1>
				</hgroup>
				<ul class="small">
					<div id="115uOEKHVTxYVXJbYfivieQ7qMcpF2jqpMYqmbxpKbVM" style="height: 470px" class="h-drawing"></div>
				</ul>
			</div>

    		<div class="slide">
				<hgroup>
					<h1>RMI Implementation in Java &ndash; Interface</h1>
				</hgroup>
				<ul class="x-small">
					<li>Shared interface</li>
					<pre class="brush: java">
						import java.rmi.Remote;
						import java.rmi.RemoteException;
						
						// shared interface between a client and a server to
						// invoke methods on the remote object
						public interface HelloRMIInterface extends Remote {
						    public String calculate(int a, int b) throws RemoteException;
						}</pre>
					<li>RMI Server</li>
					<pre class="brush: java">
					// import java.rmi classes (Naming, RemoteException, …)
					 
					public class Server extends UnicastRemoteObject implements HelloRMIInterface {
						
						private static final long serialVersionUID = 1L;
					 
					    public Server() throws RemoteException {
					    }
					
					    // implementation of the interface method
					    public int calculate(int a, int b) throws RemoteException {
					    	return a+b;
					    }</pre>	
				</ul>
			</div>
			
    		<div class="slide">
				<hgroup>
					<h1>RMI Implementation in Java &ndash; Server</h1>
				</hgroup>
				<ul class="x-small">
					<li>RMI Server (cont.)</li>
					<pre class="brush: java; highlight : [11,14,18]">						 
				        // start the server and register the object in the rmi registry
					    public static void main(String args[]) { 
					    	try {
						        // install a security manager (uses a security policy)
						        if (System.getSecurityManager() == null) {
						        	RMISecurityManager sm = new RMISecurityManager();
						            System.setSecurityManager(sm);
						        }
						
						        // create rmi registry
						        LocateRegistry.createRegistry(1099); 
						 
						        // create remote object
						        Server obj = new Server();
						 
						        // Bind the object instance to the name "HelloRMI"
						        // 0.0.0.0 denotes the service will listen on all network interfaces
						        Naming.rebind("//0.0.0.0/HelloRMI", obj);
						        
						        System.out.println("RMI server started, " + 
						        	"listening to incoming requests...");
					    	} catch (Exception e) {
					    		System.out.println("Error occurred: " + e.getLocalizedMessage());
					    	}
					    }</pre>
				</ul>
			</div>

    		<div class="slide">
				<hgroup>
					<h1>RMI Implementation in Java &ndash; Client</h1>
				</hgroup>
				<ul class="x-small">
					<li>RMI Client</li>
					<pre class="brush: java">
					import java.rmi.Naming;
					
					public class Client { 
						
					    public static void main(String args[]) throws Exception {
					    	// get a reference to the remote object
					    	// assuming the server is running on the localhost
					        HelloRMIInterface o = (HelloRMIInterface)
					        	Naming.lookup("//localhost/HelloRMI");
					        	
					        // call the object method
					        System.out.println(o.calculate(3, 4));
					    }
					}</pre>
				</ul>
			</div>
		</section>
    		
    </body>
</html>


